<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="MinhVuong&QuocHuynh - Dự án laptopshop" />
    <meta name="author" content="MinhVuong&QuocHuynh" />
    <title>Tạo mới sản phẩm - LaptopShop</title>

    <link href="/admin/css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.tiny.cloud/1/1dtzi1n2b488rghqj103opvbjkkyk3kvz7mmh0fm99xh95hq/tinymce/7/tinymce.min.js"
        referrerpolicy="origin"></script>

    <style>
        :root {
            --brand: #4f8cff;
            --glass: rgba(255, 255, 255, .06);
            --glass-bd: rgba(255, 255, 255, .10);
        }

        body.sb-nav-fixed {
            background: radial-gradient(1200px 800px at 10% 10%, #10172a 0%, #0a0f1f 45%, #080c18 100%) fixed;
        }

        .page-title {
            color: #eef2ff;
            font-weight: 800;
            letter-spacing: .2px;
        }

        .card.glass {
            border: 1px solid var(--glass-bd);
            border-radius: 18px;
            background: linear-gradient(180deg, rgba(255, 255, 255, .05), rgba(255, 255, 255, .02));
            color: #e8ecff;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            box-shadow: 0 10px 26px rgba(0, 0, 0, .25);
        }

        .card.glass .card-header {
            background: transparent;
            color: #1d2030;
            font-weight: 700;
            border-bottom: 1px solid var(--glass-bd);
        }

        .form-label {
            color: #e8ecff;
            font-weight: 500;
        }

        .form-control,
        .form-select {
            background: rgba(255, 255, 255, .06);
            color: #46559d;
            border: 1px solid var(--glass-bd);
            border-radius: 12px;
        }

        .form-control:focus,
        .form-select:focus {
            color: #cc6161;
            background: rgba(255, 255, 255, .09);
            border-color: rgba(79, 140, 255, .4);
            box-shadow: none;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, rgba(79, 140, 255, .8), rgba(139, 92, 246, .7));
            border: 1px solid rgba(255, 255, 255, .15);
            color: #fff;
            border-radius: 12px;
        }

        .btn-primary-custom:hover {
            filter: brightness(1.05);
            transform: translateY(-1px);
        }

        .btn-secondary {
            border-radius: 12px;
        }

        #avatarPreview {
            max-height: 250px;
            border-radius: 12px;
            border: 1px solid var(--glass-bd);
            box-shadow: 0 6px 16px rgba(0, 0, 0, .25);
            display: none;
        }

        .required::after {
            content: " *";
            color: #dc3545;
        }

        .breadcrumb {
            background: transparent;
        }

        .breadcrumb a {
            color: #cbd5ff;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }
    </style>

    <script>
        $(function () {
            $("#avatarFile").on("change", function (e) {
                const file = e.target.files && e.target.files[0]; if (!file) return;
                const url = URL.createObjectURL(file);
                $("#avatarPreview").attr("src", url).css("display", "block");
            });
        });
    </script>
</head>

<body class="sb-nav-fixed">
    <%- include('../layout/header'); -%>
        <div id="layoutSidenav">
            <%- include('../layout/sidenav'); -%>
                <div id="layoutSidenav_content">
                    <main>
                        <div class="container-fluid px-4">
                            <h1 class="page-title mt-4"><i class="fas fa-box-open me-2"></i> Tạo mới sản phẩm</h1>
                            <ol class="breadcrumb mb-4">
                                <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
                                <li class="breadcrumb-item"><a href="/admin/product">Sản phẩm</a></li>
                                <li class="breadcrumb-item active text-light">Tạo mới</li>
                            </ol>

                            <div class="row">
                                <div class="col-12 col-lg-10 mx-auto">
                                    <% if (Array.isArray(errors) && errors.length) { %>
                                        <div class="mb-3">
                                            <% errors.forEach(function(error){ %>
                                                <div class="alert alert-danger d-flex align-items-center" role="alert">
                                                    <i class="fa-solid fa-triangle-exclamation me-2"></i>
                                                    <div>
                                                        <%= error %>
                                                    </div>
                                                </div>
                                                <% }) %>
                                        </div>
                                        <% } %>

                                            <div class="card glass shadow-sm mb-4 rounded-3">
                                                <div class="card-header">Thông tin sản phẩm</div>
                                                <div class="card-body">
                                                    <form action="/admin/create-product" method="post"
                                                        enctype="multipart/form-data">
                                                        <div class="row">
                                                            <div class="mb-3 col-md-6">
                                                                <label class="form-label required">Tên sản phẩm</label>
                                                                <input name="name" type="text" class="form-control"
                                                                    placeholder="VD: MacBook Air M2 13-inch"
                                                                    value="<%= (oldData && oldData.name) || '' %>"
                                                                    required>
                                                            </div>
                                                            <div class="mb-3 col-md-6">
                                                                <label class="form-label required">Giá (VND)</label>
                                                                <input name="price" type="number" min="0" step="1000"
                                                                    class="form-control" placeholder="VD: 25990000"
                                                                    value="<%= (oldData && oldData.price) || '' %>"
                                                                    required>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="mb-3 col-md-8">
                                                                <label class="form-label">Mô tả ngắn</label>
                                                                <input name="shortDesc" type="text" class="form-control"
                                                                    placeholder="Tóm tắt 1-2 câu về sản phẩm"
                                                                    value="<%= (oldData && oldData.shortDesc) || '' %>">
                                                            </div>
                                                            <div class="mb-3 col-md-4">
                                                                <label class="form-label required">Số lượng</label>
                                                                <input name="quantity" type="number" min="0" step="1"
                                                                    class="form-control" placeholder="VD: 50"
                                                                    value="<%= (oldData && oldData.quantity) || '' %>"
                                                                    required>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="mb-3 col-md-4">
                                                                <label class="form-label required">Hãng sản xuất</label>
                                                                <select name="factory" class="form-select" required>
                                                                    <option value="">-- Chọn hãng --</option>

                                                                    <% var FO=(typeof factoryOptions !=='undefined' &&
                                                                        Array.isArray(factoryOptions) &&
                                                                        factoryOptions.length) ? factoryOptions : [ {
                                                                        value: 'APPLE' , name: 'Apple (MacBook)' }, {
                                                                        value: 'ASUS' , name: 'Asus' }, {
                                                                        value: 'LENOVO' , name: 'Lenovo' }, {
                                                                        value: 'DELL' , name: 'Dell' }, { value: 'LG' ,
                                                                        name: 'LG' }, { value: 'ACER' , name: 'Acer' },
                                                                        { value: 'HP' , name: 'HP' }, { value: 'MSI' ,
                                                                        name: 'MSI' }, { value: 'GIGABYTE' ,
                                                                        name: 'Gigabyte' }, { value: 'ALIENWARE' ,
                                                                        name: 'Alienware' }, ]; %>

                                                                        <% FO.forEach(opt=> { %>
                                                                            <option value="<%= opt.value %>" <%=(oldData
                                                                                && oldData.factory===opt.value)
                                                                                ? 'selected' : '' %>>
                                                                                <%= opt.name %>
                                                                            </option>
                                                                            <% }) %>
                                                                </select>
                                                            </div>

                                                            <div class="mb-3 col-md-5">
                                                                <label class="form-label required">Mục đích sử
                                                                    dụng</label>
                                                                <select name="target" class="form-select" required>
                                                                    <option value="">-- Chọn mục đích --</option>
                                                                    <option value="GAMING" <%=oldData &&
                                                                        oldData.target==='GAMING' ? 'selected' : '' %>
                                                                        >Gaming</option>
                                                                    <option value="SINHVIEN-VANPHONG" <%=oldData &&
                                                                        oldData.target==='SINHVIEN-VANPHONG'
                                                                        ? 'selected' : '' %>>Sinh viên - Văn phòng
                                                                    </option>
                                                                    <option value="THIET-KE-DO-HOA" <%=oldData &&
                                                                        oldData.target==='THIET-KE-DO-HOA' ? 'selected'
                                                                        : '' %>>Thiết kế đồ họa</option>
                                                                    <option value="MONG-NHE" <%=oldData &&
                                                                        oldData.target==='MONG-NHE' ? 'selected' : '' %>
                                                                        >Mỏng nhẹ</option>
                                                                    <option value="DOANH-NHAN" <%=oldData &&
                                                                        oldData.target==='DOANH-NHAN' ? 'selected' : ''
                                                                        %>>Doanh nhân</option>
                                                                </select>
                                                            </div>
                                                            <div class="mb-3 col-md-3">
                                                                <label class="form-label">Giảm giá (%)</label>
                                                                <input name="discount" type="number" min="0" max="100"
                                                                    step="1" class="form-control" placeholder="VD: 10"
                                                                    value="<%= (oldData && oldData.discount) || '' %>">
                                                            </div>
                                                        </div>
                                                        <!-- ===== Thông số kỹ thuật (CREATE) ===== -->
                                                        <div class="card glass shadow-sm mb-4 rounded-3">
                                                            <div class="card-header">Thông số kỹ thuật</div>
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    <div class="mb-3 col-md-6">
                                                                        <label class="form-label">CPU</label>
                                                                        <input name="cpu" type="text"
                                                                            class="form-control"
                                                                            placeholder="VD: Intel Core i5-1240P / Ryzen 7 7840HS / Apple M2"
                                                                            value="<%= (oldData && oldData.cpu) || '' %>">
                                                                    </div>
                                                                    <div class="mb-3 col-md-3">
                                                                        <label class="form-label">RAM (GB)</label>
                                                                        <input name="ramGB" type="number" min="1"
                                                                            step="1" class="form-control"
                                                                            value="<%= (oldData && oldData.ramGB) || '' %>">
                                                                    </div>
                                                                    <div class="mb-3 col-md-3">
                                                                        <label class="form-label">Ổ cứng (GB)</label>
                                                                        <input name="storageGB" type="number" min="1"
                                                                            step="1" class="form-control"
                                                                            value="<%= (oldData && oldData.storageGB) || '' %>">
                                                                    </div>
                                                                </div>

                                                                <div class="row">
                                                                    <div class="mb-3 col-md-4">
                                                                        <label class="form-label">Loại ổ</label>
                                                                        <select name="storageType" class="form-select">
                                                                            <option value="">-- Chọn --</option>
                                                                            <option value="HDD"
                                                                                <%=oldData?.storageType==='HDD'
                                                                                ? 'selected' : '' %>>HDD</option>
                                                                            <option value="SSD"
                                                                                <%=oldData?.storageType==='SSD'
                                                                                ? 'selected' : '' %>>SSD</option>
                                                                            <option value="NVME"
                                                                                <%=oldData?.storageType==='NVME'
                                                                                ? 'selected' : '' %>>NVMe</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="mb-3 col-md-4">
                                                                        <label class="form-label">Độ phân giải</label>
                                                                        <select name="screenResolution"
                                                                            class="form-select">
                                                                            <option value="">-- Chọn --</option>
                                                                            <option value="FHD"
                                                                                <%=oldData?.screenResolution==='FHD'
                                                                                ? 'selected' : '' %>>FHD (1920×1080)
                                                                            </option>
                                                                            <option value="QHD"
                                                                                <%=oldData?.screenResolution==='QHD'
                                                                                ? 'selected' : '' %>>QHD / 2K</option>
                                                                            <option value="4K"
                                                                                <%=oldData?.screenResolution==='4K'
                                                                                ? 'selected' : '' %>>4K</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="mb-3 col-md-4">
                                                                        <label class="form-label">Màn hình
                                                                            (inch)</label>
                                                                        <input name="screenSizeInch" type="number"
                                                                            min="10" step="0.1" class="form-control"
                                                                            placeholder="VD: 13.3, 14.0, 15.6"
                                                                            value="<%= (oldData && oldData.screenSizeInch) || '' %>">
                                                                    </div>
                                                                </div>

                                                                <div class="mb-3">
                                                                    <label class="form-label">Tính năng đặc biệt</label>
                                                                    <input name="featureTagsRaw" type="text"
                                                                        class="form-control"
                                                                        placeholder="Nhập dạng: TOUCH,2IN1,TB4,FP"
                                                                        value="<%= (oldData && oldData.featureTagsRaw) || '' %>">
                                                                    <small class="text-muted">Hệ thống sẽ lưu thành dạng
                                                                        “|TOUCH|2IN1|TB4|FP|”.</small>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label">Ảnh đại diện</label>
                                                            <input name="image" class="form-control" type="file"
                                                                id="avatarFile" accept=".png, .jpg, .jpeg, .webp">
                                                            <div class="avatar-container mt-2">
                                                                <img id="avatarPreview" alt="avatar preview" />
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label">Mô tả chi tiết</label>
                                                            <textarea id="detailDesc" name="detailDesc"
                                                                rows="8"><%= (oldData && oldData.detailDesc) ? oldData.detailDesc : '' %></textarea>
                                                        </div>

                                                        <div class="d-flex justify-content-between">
                                                            <a href="/admin/product" class="btn btn-secondary"><i
                                                                    class="fas fa-arrow-left me-1"></i> Quay lại</a>
                                                            <button class="btn btn-primary-custom" type="submit"><i
                                                                    class="fas fa-save me-1"></i> Tạo mới</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>

                                </div>
                            </div>

                        </div>
                    </main>
                    <%- include('../layout/footer'); -%>
                </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
        <script src="/admin/js/scripts.js"></script>

        <script>
            // Preview ảnh
            $(document).ready(() => {
                const avatarFile = $("#avatarFile");
                avatarFile.on("change", function (e) {
                    const file = e.target.files && e.target.files[0];
                    if (!file) return;
                    const imgURL = URL.createObjectURL(file);
                    $("#avatarPreview").attr("src", imgURL).css("display", "block");
                });
            });

            // TinyMCE
            tinymce.init({
                selector: '#detailDesc',
                height: 420,
                menubar: true,
                plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
                toolbar: 'undo redo | blocks | bold italic underline forecolor backcolor removeformat | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media table | charmap emoticons | codesample | searchreplace',
                branding: false,
                content_style: 'body { font-family: Inter, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; font-size: 14px; }'
            });
        </script>
</body>

</html>