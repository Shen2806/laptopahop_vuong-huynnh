<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chat với khách hàng - LaptopShop</title>

    <!-- Base styles (template của bạn) -->
    <link href="/admin/css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

    <!-- Polished theme for chat -->
    <style>
        :root {
            --brand: #4f8cff;
            --brand-2: #8b5cf6;
            --glass: rgba(255, 255, 255, .06);
            --glass-border: rgba(255, 255, 255, .10);
            --muted: #aeb6c8;
        }

        body.sb-nav-fixed {
            background: radial-gradient(1200px 800px at 10% 10%, #10172a 0%, #0a0f1f 45%, #080c18 100%) fixed;
        }

        .page-title {
            color: #eef2ff;
            font-weight: 800;
            letter-spacing: .2px;
        }

        .breadcrumb {
            background: transparent;
        }

        .glass-card {
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            background: linear-gradient(180deg, rgba(255, 255, 255, .05), rgba(255, 255, 255, .02));
            color: #e8ecff;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            box-shadow: 0 10px 26px rgba(0, 0, 0, .25);
        }

        .glass-card .card-header {
            background: transparent;
            color: #cbd5ff;
            font-weight: 700;
            border-bottom: 1px solid var(--glass-border);
        }

        /* Sessions buttons */
        #sessions .btn {
            background: rgba(255, 255, 255, .06);
            border: 1px solid var(--glass-border);
            color: #e7ecff;
            border-radius: 12px;
            padding: 6px 12px;
        }

        #sessions .btn:hover {
            background: rgba(255, 255, 255, .10);
            color: #fff;
        }

        /* Chat area */
        .chat-scroll {
            height: 460px;
            overflow: auto;
            background: rgba(255, 255, 255, .03);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
        }

        .chat-area .bg-primary {
            background: linear-gradient(135deg, #4f8cff, #8b5cf6) !important;
            border: 0 !important;
        }

        .chat-area .bg-light {
            background: rgba(255, 255, 255, .08) !important;
            color: #e7ecff !important;
            border: 1px solid var(--glass-border) !important;
        }

        /* Input row */
        #adminForm .form-control {
            background: rgba(255, 255, 255, .06);
            border: 1px solid var(--glass-border);
            color: #e7ecff;
        }

        #adminForm .form-control::placeholder {
            color: rgba(255, 255, 255, .55);
        }

        #adminForm .form-control:focus {
            box-shadow: none;
            border-color: rgba(79, 140, 255, .5);
        }

        /* Soft header badge */
        #adminChatBadge {
            font-weight: 700;
        }
    </style>
</head>

<body class="sb-nav-fixed">
    <%- include('../layout/header'); -%>

        <div id="layoutSidenav">
            <%- include('../layout/sidenav'); -%>

                <div id="layoutSidenav_content">
                    <main>
                        <div class="container-fluid px-4">

                            <!-- Title + breadcrumb -->
                            <div class="d-flex align-items-center justify-content-between mt-4 mb-2">
                                <h1 class="page-title">Chat với khách hàng</h1>
                                <ol class="breadcrumb mb-0">
                                    <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
                                    <li class="breadcrumb-item active">Chat</li>
                                </ol>
                            </div>

                            <!-- Sessions -->
                            <div class="card glass-card mb-4">
                                <div class="card-header d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="fa-solid fa-comments me-1"></i> Phiên đang mở
                                    </div>
                                    <span id="adminChatBadge" class="badge bg-danger d-none">0</span>
                                </div>
                                <div class="card-body">
                                    <div id="sessions" class="d-flex flex-wrap gap-2"></div>
                                </div>
                            </div>

                            <!-- Panel -->
                            <div id="panel" class="row d-none">
                                <div class="col-xl-8">
                                    <div class="card glass-card h-100">
                                        <div class="card-header d-flex align-items-center">
                                            <i class="fa-regular fa-message me-2"></i> Phòng chat
                                            <div class="ms-auto">
                                                <button id="closeSession" class="btn btn-outline-danger btn-sm">
                                                    <i class="fa-regular fa-circle-xmark me-1"></i> Kết thúc phiên
                                                </button>
                                            </div>
                                        </div>

                                        <div class="card-body d-flex flex-column chat-area">
                                            <div id="roomMsgs" class="flex-grow-1 rounded p-3 mb-2 chat-scroll"></div>
                                            <div id="typingHintAdmin" class="small text-muted d-none">Khách đang nhập…
                                            </div>

                                            <form id="adminForm" class="d-flex gap-2 mt-2">
                                                <input id="adminInput" class="form-control"
                                                    placeholder="Nhập trả lời...">
                                                <button class="btn btn-primary">
                                                    <i class="fa-regular fa-paper-plane me-1"></i> Gửi
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-4">
                                    <div class="card glass-card h-100">
                                        <div class="card-header"><i class="fa-solid fa-circle-info me-2"></i> Gợi ý
                                            nhanh</div>
                                        <div class="card-body small text-muted">
                                            <ul class="mb-0 ps-3">
                                                <li>Dùng <b>Enter</b> để gửi, <b>Shift+Enter</b> để xuống dòng.</li>
                                                <li><b>Kết thúc phiên</b> sẽ khóa chat ở cả hai phía.</li>
                                                <li>Khi có tin mới, phần <b>Phiên đang mở</b> sẽ hiện badge.</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </main>

                    <%- include('../layout/footer'); -%>
                </div>
        </div>

        <!-- Scripts -->
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
        <script src="/admin/js/scripts.js"></script>
        <script src="/admin/js/chat.js"></script>
</body>

</html>