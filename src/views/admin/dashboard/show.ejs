<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="MinhVuong&QuocHuynh - D·ª± √°n laptopshop" />
    <meta name="author" content="MinhVuong&QuocHuynh" />
    <title>Dashboard - LaptopShop</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="/admin/css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
</head>

<body class="sb-nav-fixed">
    <%- include('../layout/header'); -%>


        <div id="layoutSidenav">
            <%- include('../layout/sidenav'); -%>
                <div id="layoutSidenav_content">
                    <main>
                        <div class="container-fluid px-4">
                            <h1 class="mt-4">Dashboard</h1>
                            <ol class="breadcrumb mb-4">
                                <li class="breadcrumb-item active">Dashboard</li>
                            </ol>
                            <!-- Doanh thu t·ªïng -->
                            <div
                                class="alert alert-warning d-flex justify-content-between align-items-center fs-5 fw-bold">
                                <span>
                                    üí∞ T·ªïng doanh thu:
                                    <%= new Intl.NumberFormat('vi-VN', { style: 'currency' , currency: 'VND' })
                                        .format(info?.totalRevenue ?? 0) %>
                                </span>
                                <small class="text-muted">* Ch·ªâ t√≠nh ƒë∆°n ƒë√£ thanh to√°n</small>
                            </div>
                            <!-- H√†ng 1: C√°c card th·ªëng k√™ -->
                            <div class="row">
                                <div class="col-xl-4 col-md-6">
                                    <div class="card bg-primary text-white mb-4">
                                        <div class="card-body">Ng∆∞·ªùi d√πng (<%= info?.countUser ?? 0 %>)</div>
                                        <div class="card-footer d-flex align-items-center justify-content-between">
                                            <a class="small text-white stretched-link" href="/admin/user">Xem ng∆∞·ªùi
                                                d√πng</a>
                                            <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-4 col-md-6">
                                    <div class="card bg-danger text-white mb-4">
                                        <div class="card-body">S·∫£n ph·∫©m (<%= info?.countProduct ?? 0 %>)</div>
                                        <div class="card-footer d-flex align-items-center justify-content-between">
                                            <a class="small text-white stretched-link" href="/admin/product">Xem s·∫£n
                                                ph·∫©m</a>
                                            <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-4 col-md-6">
                                    <div class="card bg-success text-white mb-4">
                                        <div class="card-body">ƒê∆°n h√†ng (<%= info?.countOrder ?? 0 %>)</div>
                                        <div class="card-footer d-flex align-items-center justify-content-between">
                                            <a class="small text-white stretched-link" href="/admin/order">Xem ƒë∆°n
                                                h√†ng</a>
                                            <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                        </div>
                                    </div>
                                </div>


                            </div>

                            <!-- H√†ng 2: B√°o c√°o v√† c·∫£nh b√°o -->
                            <div class="row">
                                <!-- S·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng -->
                                <div class="col-xl-4 col-md-6">
                                    <div class="card bg-warning text-dark mb-4">
                                        <div class="card-body d-flex flex-column">
                                            <span class="fw-bold">S·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng (d∆∞·ªõi 10 sp)</span>
                                            <% if(info?.lowStockProducts?.length> 0) { %>
                                                <ul class="mt-2 mb-0">
                                                    <% info.lowStockProducts.forEach(p=> { %>
                                                        <li>
                                                            <%= p.name %>
                                                                (<span class="fw-bold text-danger">
                                                                    <%= p.quantity %>
                                                                </span> c√≤n l·∫°i)
                                                        </li>
                                                        <% }) %>
                                                </ul>
                                                <% } else { %>
                                                    <span class="mt-2">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o s·∫Øp h·∫øt h√†ng</span>
                                                    <% } %>
                                        </div>
                                        <div class="card-footer d-flex align-items-center justify-content-between">
                                            <a class="small text-dark stretched-link" href="/admin/product">Qu·∫£n l√Ω
                                                kho</a>
                                            <div class="small text-dark"><i class="fas fa-angle-right"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- S·∫£n ph·∫©m khuy·∫øn m√£i -->
                                <div class="col-xl-4 col-md-6">
                                    <div class="card bg-info text-dark mb-4">
                                        <div class="card-body d-flex flex-column">
                                            <span class="fw-bold">S·∫£n ph·∫©m khuy·∫øn m√£i</span>
                                            <% if(info?.promoProducts?.length> 0) { %>
                                                <ul class="mt-2 mb-0">
                                                    <% info.promoProducts.forEach(p=> { %>
                                                        <li>
                                                            <%= p.name %>
                                                                - <span class="text-success fw-bold">
                                                                    <%= p.discount %>% OFF
                                                                </span>
                                                        </li>
                                                        <% }) %>
                                                </ul>
                                                <% } else { %>
                                                    <span class="mt-2">Hi·ªán ch∆∞a c√≥ s·∫£n ph·∫©m khuy·∫øn m√£i</span>
                                                    <% } %>
                                        </div>
                                        <div class="card-footer d-flex align-items-center justify-content-between">
                                            <a class="small text-dark stretched-link" href="/admin/promo">Qu·∫£n
                                                l√Ω khuy·∫øn m√£i</a>
                                            <div class="small text-dark"><i class="fas fa-angle-right"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Top s·∫£n ph·∫©m b√°n ch·∫°y -->
                                <div class="card mb-4" style="max-width: 1100px; margin: auto;">
                                    <div class="card-header">
                                        <i class="fas fa-chart-line me-1"></i>
                                        Bi·ªÉu ƒë·ªì Top s·∫£n ph·∫©m b√°n ch·∫°y
                                    </div>
                                    <div class="card-body">
                                        <div style="height: 550px;">
                                            <canvas id="topProductsChart"
                                                data-labels='<%- JSON.stringify(info?.topProducts?.map(p => p.name) || []) %>'
                                                data-values='<%- JSON.stringify(info?.topProducts?.map(p => p.quantitySold) || []) %>'>
                                            </canvas>
                                        </div>
                                    </div>
                                </div>



                                <!-- Modal nh·∫≠p th√™m h√†ng -->
                                <div class="modal fade" id="restockModal" tabindex="-1"
                                    aria-labelledby="restockModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <form id="restockForm" method="post" action="/admin/product/restock">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="restockModalLabel">Nh·∫≠p th√™m h√†ng</h5>
                                                    <button type="button" class="btn-close"
                                                        data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <input type="hidden" name="productId" id="restockProductId">
                                                    <div class="mb-3">
                                                        <label class="form-label">S·∫£n ph·∫©m</label>
                                                        <input type="text" class="form-control" id="restockProductName"
                                                            disabled>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label">S·ªë l∆∞·ª£ng th√™m</label>
                                                        <input type="number" name="quantity" class="form-control"
                                                            min="1" required>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">H·ªßy</button>
                                                    <button type="submit" class="btn btn-primary">X√°c nh·∫≠n</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>

                            </div>
                    </main>
                    <%- include('../layout/footer'); -%>

                </div>

        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
        <script src="/admin/js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"
            crossorigin="anonymous"></script>
        <script src="/admin/assets/demo/chart-area-demo.js"></script>
        <script src="/admin/assets/demo/chart-bar-demo.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"
            crossorigin="anonymous"></script>
        <script src="/admin/js/datatables-simple-demo.js"></script>
        // modal sp s·∫Øp h·∫øt h√†ng
        <script>
            const restockModal = document.getElementById('restockModal');
            restockModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const productId = button.getAttribute('data-product-id');
                const productName = button.getAttribute('data-product-name');

                document.getElementById('restockProductId').value = productId;
                document.getElementById('restockProductName').value = productName;
            });
        </script>

        // bi·ªÉu ƒë·ªì s·∫£n ph·∫©m b√°n ch·∫°y theo th·ªùi gian
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const canvas = document.getElementById('topProductsChart');
                const labels = JSON.parse(canvas.dataset.labels || "[]");
                const values = JSON.parse(canvas.dataset.values || "[]");

                new Chart(canvas, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'S·ªë l∆∞·ª£ng ƒë√£ b√°n',
                            data: values,
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)',
                                'rgba(153, 102, 255, 0.7)'
                            ],
                            borderColor: [
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: true }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { precision: 0 }
                            }
                        }
                    }
                });
            });
        </script>


</body>

</html>